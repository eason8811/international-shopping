server:
  port: 8080

spring:
  application:
    name: international-shopping
  profiles:
    active: dev
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${spring.datasource.host}:${spring.datasource.port}/shopdb?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
    username: ${spring.datasource.username}
    password: ${spring.datasource.password}
    hikari:
      pool-name: shopdb-hikari
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 600000     # 10min
      max-lifetime: 1800000    # 30min
      connection-timeout: 30000
  data:
    redis:
      host: ${spring.data.redis.host}
      port: ${spring.data.redis.port}
      password: ${spring.data.redis.password}
      database: ${spring.data.redis.database}
      timeout: 3000
      lettuce:
        pool:
          max-active: 16
          max-idle: 8
          min-idle: 0
          time-between-eviction-runs: 120s
  rabbitmq:
    host: ${spring.rabbitmq.host}
    port: ${spring.rabbitmq.port}
    username: ${spring.rabbitmq.username}
    password: ${spring.rabbitmq.password}
    virtual-host: ${spring.rabbitmq.virtual-host:/}
    publisher-confirm-type: correlated
    publisher-returns: true
    template:
      mandatory: true
    listener:
      simple:
        acknowledge-mode: manual

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    jdbc-type-for-null: 'NULL'
    default-executor-type: SIMPLE
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: AUTO
      table-underline: true


security:
  cookie:
    secure: ${security.cookie.secure}
    sameSite: ${security.cookie.sameSite}
    path: ${security.cookie.path}
    httpOnly: ${security.cookie.httpOnly}
  jwt:
    issuer: ${security.jwt.issuer}
    audience: ${security.jwt.audience}
    secret-base64: ${security.jwt.secret-base64}
    clock-skew-seconds: ${security.jwt.clock-skew-seconds}
    access-token-validity-seconds: ${security.jwt.access-token-validity-seconds}
    refresh-token-validity-seconds: ${security.jwt.refresh-token-validity-seconds}

oauth2:
  auth-provider-properties-list:
    # 1. Google
    - provider: GOOGLE
      issuer: https://accounts.google.com
      client-id: '${GOOGLE_CLIENT_ID}'
      client-secret: '${GOOGLE_CLIENT_SECRET}'
      authorization-endpoint: https://accounts.google.com/o/oauth2/v2/auth
      token-endpoint: https://oauth2.googleapis.com/token
      userinfo-endpoint: https://openidconnect.googleapis.com/v1/userinfo
      jwk-set-uri: https://www.googleapis.com/oauth2/v3/certs
      login-redirect-uri: https://shopping.mynatapp.cc/api/v1/oauth2/GOOGLE/callback
      bind-redirect-uri: https://shopping.mynatapp.cc/api/v1/users/me/bindings/oauth2/GOOGLE/callback
      scope: openid email profile
      default-success-redirect: http://localhost:8080
      clock-skew-seconds: 120

    # 2. TikTok - OAuth2 + Login Kit, 标准授权码 + PKCE, 无 id_token
    - provider: TIKTOK
      issuer: https://open.tiktokapis.com
      client-id: '${TIKTOK_CLIENT_KEY}'         # 在代码里仍用 clientId 字段, 真正发请求时用 client_key
      client-secret: '${TIKTOK_CLIENT_SECRET}'
      authorization-endpoint: https://www.tiktok.com/v2/auth/authorize/
      token-endpoint: https://open.tiktokapis.com/v2/oauth/token/
      # 直接把 fields 固定写死在 url 上, 避免 Retrofit 再拼 query
      userinfo-endpoint: https://open.tiktokapis.com/v2/user/info/?fields=open_id,display_name,avatar_url
      jwk-set-uri: ''                           # 非 OIDC
      login-redirect-uri: https://shopping.mynatapp.cc/api/v1/oauth2/TIKTOK/callback
      bind-redirect-uri: https://shopping.mynatapp.cc/api/v1/users/me/bindings/oauth2/TIKTOK/callback
      scope: user.info.basic
      default-success-redirect: http://localhost:8080
      clock-skew-seconds: 120

    # 3. X - OAuth2 + PKCE, 无 id_token, userinfo 用 /2/users/me
    - provider: X
      issuer: https://api.x.com
      client-id: '${X_CLIENT_ID}'
      client-secret: '${X_CLIENT_SECRET}'
      authorization-endpoint: https://x.com/i/oauth2/authorize
      token-endpoint: https://api.x.com/2/oauth2/token
      userinfo-endpoint: https://api.x.com/2/users/me?user.fields=confirmed_email,profile_image_url,name,username,verified,verified_type
      jwk-set-uri: https://api.x.com/2/oauth2/jwks
      login-redirect-uri: https://shopping.mynatapp.cc/api/v1/oauth2/X/callback
      bind-redirect-uri: https://shopping.mynatapp.cc/api/v1/users/me/bindings/oauth2/X/callback
      scope: users.read tweet.read users.email
      default-success-redirect: http://localhost:8080
      clock-skew-seconds: 120

# Resend 配置
resend:
  api-key: ${RESEND_API_KEY}
  from-email: leila@eason.xin
  from-name: international-shopping
  activation-subject: Your verification code
  password-reset-subject: Your password reset code


# FX 汇率与派生配置
fx:
  rate:
    # 全站默认基准币种
    baseCurrency: USD
    sync:
      # 汇率同步任务：启动后首次延迟
      initialDelay: 30s
      # 汇率同步任务：执行间隔(固定延迟)
      fixedDelay: 1h

orders:
  timeout:
    ttl: 15m
    cancel-reason: 支付超时自动取消
    mq:
      exchange: orders.delay.exchange
      queue: orders.timeout.delay.queue
      routing-key: orders.timeout
      delayed-type: direct
      listener-concurrency: 2
      listener-prefetch: 10
    recovery:
      fixed-delay: 5m
      batch-size: 100

# PayPal 网关配置（建议通过环境变量注入敏感信息）
paypal:
  base-url: https://api-m.sandbox.paypal.com
  client-id: ${PAYPAL_CLIENT_ID}
  client-secret: ${PAYPAL_CLIENT_SECRET}
  webhook-id: ${PAYPAL_WEBHOOK_ID}
  replay-ttl: 1d
  clock-skew: 5m

# 支付状态兜底同步任务（低频）
payments:
  sync:
    fixed-delay: 30m
    batch-size: 50

brand-config:
  brand: test-brand